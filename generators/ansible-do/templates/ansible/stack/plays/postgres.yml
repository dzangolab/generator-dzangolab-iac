- name: Create required postgres directories on the NFS server
  hosts: nfs_server
  become: yes
  tasks:
    - name: Ensure necessary directories exist
      file:
        group: "nogroup"
        owner: "nobody"
        path: "/mnt/nfs/postgres/{{ item }}/{{ subdir }}"
        state: directory
        recurse: true
      with_subelements:
        - "{{ postgres_versions }}"
        - subdirs
      vars:
        subdirs:
          - "backups"
          - "data"
  when:
    - nfs

- name: Create postgres data directories on swarm node
  hosts: portainer
  become: true
  tasks:
    - file:
        group: "{{ deploy_group }}"
        owner: "{{ deploy_user }}"
        path: "{{ item }}"
        state: directory
        recurse: true
        - "{{ postgres_versions }}"
        - subdirs
      vars:
        subdirs:
          - "backups"
          - "data"
  when:
    - not nfs
